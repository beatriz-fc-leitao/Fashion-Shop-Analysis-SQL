CREATE TABLE BUILDING (
	BUILDING_ID CHAR(5) NOT NULL,
    STREET VARCHAR(20) NOT NULL,
    BUILDING_NO INT NOT NULL,
    CITY VARCHAR(20),
    COUNTRY VARCHAR(20) NOT NULL,
    PRIMARY KEY (BUILDING_ID)
);

CREATE TABLE DEPARTMENT (
	DEPARTMENT_NO CHAR(3) NOT NULL,
    DEPARTMENT_NAME VARCHAR(30) NOT NULL,
    DATE_CREATED DATE,
    PHONE_NO CHAR(13),
    BUILDING_ID CHAR(5) NOT NULL,
   PRIMARY KEY (DEPARTMENT_NO)
);

CREATE TABLE EMPLOYEE (
	EMPLOYEE_NO CHAR(6) NOT NULL,
    DEPARTMENT_NO CHAR(3) NOT NULL,
    FIRST_NAME VARCHAR(20) NOT NULL,
    LAST_NAME VARCHAR(20) NOT NULL,
    HIRE_DATE DATE,
   	DATE_OF_BIRTH DATE,
    SALARY INT,
    COMMISSION INT,
    BONUS INT,
    JOB CHAR(8) NOT NULL,
	PRIMARY KEY (EMPLOYEE_NO)
);

ALTER TABLE DEPARTMENT
	ADD FOREIGN KEY (BUILDING_ID)
	REFERENCES BUILDING (BUILDING_ID);

ALTER TABLE EMPLOYEE
	ADD FOREIGN KEY (DEPARTMENT_NO)
	REFERENCES DEPARTMENT (DEPARTMENT_NO);
    
INSERT INTO BUILDING VALUES
('00001', 'Maria de Molina', 20, 'Madrid', 'Spain'),
('00002', 'Velazquez', 34, 'Madrid', 'Spain'),
('00003', 'Portobello', 7, 'London', 'United Kingdom'),
('00004', 'Pitfield', 6, 'London', 'United Kingdom'),
('00005', 'Augusta', 10, 'Lisbon', 'Portugal');

INSERT INTO DEPARTMENT VALUES
('A01', 'Operations', '2015-01-08', '0034660858646', '00001'),
('A02', 'Accounting and Finance', '2015-03-01', '0034642401677', '00001'),
('A03', 'Marketing', '2015-03-01', '0034682128046 ', '00002'),
('A04', 'Human Resources', NULL, '0034649751694' , '00002'),
('A05', 'Software Support', NULL, '0044745678911' , '00003'),
('A06', 'Administration', '2015-01-20', '0044639840760', '00004'),
('A07', 'Manufacturing', '2015-01-21', NULL, '00005');

INSERT INTO EMPLOYEE VALUES
('000001', 'A01', 'Steven', 'Malley', '2015-01-08', '1980-05-05', 50000, 2000, 3000, 'Manager'),
('000002', 'A01', 'Anna', 'Haines', '2015-01-08', '1985-08-01', 45000, 1500, 3200, 'Operator'),
('000003', 'A01', 'Beatriz', 'Leitao', NULL, '2001-03-01', 35000, 1000, 0, 'Analyst'),
('000004', 'A02', 'Vasco', 'Lopes', '2015-03-01', NULL, 50000, 2000, 3000, 'Manager'),
('000005', 'A02', 'Jannet', 'Ovens', NULL, NULL, 35000, 1000, 0, 'Analyst'),
('000006', 'A03', 'Ella', 'Kenny', NULL, '1985-05-07', 30000, 1000, 500, 'Manager'),
('000007', 'A04', 'Sonia', 'Ammar', '2015-01-08', '1999-01-04', 45000, 1500, 3200, 'Manager'),
('000008', 'A05', 'Elio', 'Moot', '2015-01-08', NULL, 20000, 1000, 500, 'Manager'),
('000009', 'A05', 'Claudia', 'Sona', '2016-04-01', '1992-07-01', 15000, 500, 0, 'Operator'),
('000010', 'A06', 'Cristina', 'Ainscough', '2015-12-01', '1965-02-05', 50000, 2000, 3000, 'Manager'),
('000011', 'A07', 'Mia', 'Pope', '2015-01-08', '1983-01-01', 40000, 2000, 1000, 'Manager'),
('000012', 'A07', 'Bella', 'Lee', '2015-01-08', NULL, 12000, 0, 500, 'Operator'),
('000013', 'A07', 'Josh', 'Jones', '2016-09-01', '1977-05-05', 12000, 0, 500, 'Operator'),
('000014', 'A07', 'Chris', 'Jukic', '2016-10-01', '1973-09-03', 12000, 0, 500, 'Operator');

#Q1 - How many employees work in each building?
SELECT B.BUILDING_ID, COUNT(E.EMPLOYEE_NO) AS EMPLOYEE_COUNT
FROM BUILDING B
JOIN DEPARTMENT D ON (B.BUILDING_ID = D.BUILDING_ID)
JOIN EMPLOYEE E ON (D.DEPARTMENT_NO = E.DEPARTMENT_NO)
GROUP BY BUILDING_ID;

#Q2 - How many employees earn in total (salary + commission + bonus) more than 45,000 in each department?
SELECT DEPARTMENT_NAME, COUNT(EMPLOYEE_NO) AS EMPLOYEE_COUNT
FROM DEPARTMENT D
JOIN EMPLOYEE E ON(D.DEPARTMENT_NO = E.DEPARTMENT_NO)
WHERE (COALESCE(SALARY, 0) + COALESCE(COMMISSION, 0) + COALESCE(BONUS, 0)) > 45000
GROUP BY DEPARTMENT_NAME;

#Q3 - Which departments are based in Madrid, Spain?
SELECT DEPARTMENT_NAME
FROM DEPARTMENT D
JOIN BUILDING B ON (D.BUILDING_ID = B.BUILDING_ID)
WHERE UPPER(B.CITY) = 'MADRID';

#Q4 - How many employees younger than 25 work in each department?
SELECT DEPARTMENT_NAME, COUNT(EMPLOYEE_NO)
FROM EMPLOYEE E
JOIN DEPARTMENT D ON (E.DEPARTMENT_NO = D.DEPARTMENT_NO)
WHERE FLOOR(DATEDIFF(CURRENT_DATE(), DATE_OF_BIRTH) / 365.25) < 25
GROUP BY DEPARTMENT_NAME;

#Q5 - What are the names, age, and salary of the employees found in Q4?
SELECT CONCAT(FIRST_NAME, ' ', LAST_NAME) NAME, FLOOR(DATEDIFF(CURRENT_DATE(), DATE_OF_BIRTH) / 365.25) AGE, SALARY
FROM EMPLOYEE E 
JOIN DEPARTMENT D ON (E.DEPARTMENT_NO = D.DEPARTMENT_NO)
WHERE FLOOR(DATEDIFF(CURRENT_DATE(), DATE_OF_BIRTH) / 365.25) < 25;
